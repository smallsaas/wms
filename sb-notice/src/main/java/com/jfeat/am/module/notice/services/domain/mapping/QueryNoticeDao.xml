<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jfeat.am.module.notice.services.domain.dao.QueryNoticeDao">
    <sql id="Base_Column_List">
        t_notice.*
    </sql>
    <select id="findNotices" resultType="Notice" parameterType="Notice">
        SELECT t_notice.*
        FROM t_notice
        WHERE 1=1
        <if test="notice.type != null and notice.type!= ''">
            AND t_notice.type = #{notice.type}
        </if>
        <if test="notice.status != null and notice.status!= ''">
            AND t_notice.status = #{notice.status}
        </if>
        <if test="notice.enabled != null">
            AND t_notice.enabled = #{notice.enabled}
        </if>
        <if test="notice.title != null and notice.title!= ''">
            AND t_notice.title LIKE CONCAT('%',#{notice.title},'%')
        </if>
        <if test="notice.content != null and notice.content!= ''">
            AND t_notice.content LIKE CONCAT('%',#{notice.content},'%')
        </if>
        <if test="notice.createTime != null">
            AND t_notice.create_time LIKE CONCAT('%',#{notice.createTime},'%')
        </if>
        <if test="notice.updateTime != null">
            AND t_notice.update_time LIKE CONCAT('%',#{notice.updateTime},'%')
        </if>
        <if test="notice.endTime != null">
            AND t_notice.end_time LIKE CONCAT('%',#{notice.endTime},'%')
        </if>
        <if test="expired != null">
            <if test="expired == 1">
                AND (t_notice.end_time IS NOT NULL AND CURRENT_TIMESTAMP &gt;= DATE_ADD(t_notice.end_time, interval 1 day))
            </if>
            <if test="expired == 0">
                AND (t_notice.end_time IS NULL OR DATE_ADD(t_notice.end_time, interval 1 day) &gt; CURRENT_TIMESTAMP)
            </if>
        </if>

        ORDER BY t_notice.order_num DESC
    </select>

    <select id="findExpiredNotices" resultType="Notice">
        SELECT t_notice.*
        FROM t_notice
        WHERE t_notice.end_time IS NOT NULL AND CURRENT_TIMESTAMP &gt;= DATE_ADD(t_notice.end_time, interval 1 day)
    </select>

    <select id="findRecentNotices" resultType="Notice">
        SELECT t_notice.*
        FROM t_notice
        WHERE (t_notice.end_time IS NULL OR DATE_ADD(t_notice.end_time, interval 1 day) &gt; CURRENT_TIMESTAMP) AND (t_notice.enabled=1)

        ORDER BY t_notice.end_time DESC,t_notice.order_num DESC
    </select>
</mapper>